<!--?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://peachfuzzer.com/2012/Peach /peach/peach.xsd"-->
<Peach>

	<!--PythonPath path="/usr/bin/python2"/-->
	<Import import="customFixup" />
	<Import import="additionalCode" />

	<!-- TODO: Create data model -->

	<DataModel name="M5">
		<String name="a" />
	</DataModel>

	<DataModel name="done">
		<String name="a" value="Das "/>
		<String name="b" value="ist "/>
		<String name="c" value="eine "/>
		<String name="d" />
		<String name="e" value="!"/>
	</DataModel>


	<DataModel name="rand">
		<String name="a1" mutable="false"/>
	</DataModel>

	<StateModel name="StateModel" initialState="InitialState">
		<State name="InitialState">
			<Action name="rec" type="input">
				<DataModel name="read" ref="M5" />
			</Action>
			<Action type="changeState" ref="5"/>
		</State>

		<State name="5">
			<Action type="output">
				<DataModel ref="done"/>
			<Data>
				<Field name="d" value="Achterbahn"/>
			</Data>
			<Data >
				<Field name="d" value="Test"/>
			</Data>
			<Data >
				<Field name="d" value="...?"/>
			</Data>
			<Data >
				<Field name="d" value="Wasser"/>
			</Data>
			</Action>

			<Action type="output" publisher="null" onStart="additionalCode.rand(self,3)">
				<DataModel ref="rand"/>
			</Action>

			<Action type="changeState" ref="end" when="int(StateModel.states['5'].actions[1].dataModel['a1'].InternalValue) == int(0)"/>

			<Action type="changeState" ref="InitialState"/>
		</State>

		<State name="end">
			<Action type="close"/>
		</State>
	</StateModel>

	<!-- TODO: Configure Agent -->
	<!--Agent name="TheAgent" location="http://127.0.0.1:9000">
	</Agent-->

	<Agent name="Local">
		<!--Monitor class="LinuxCrashMonitor"/-->
		<Monitor class="Process">
			<Param name="Executable" value="./server"/>
			<Param name="StartOnCall" value="Start"/>
			<Param name="Arguments" value="fuzzed.bin"/>
		</Monitor>
	</Agent>

	<Test name="Default">
		<Agent ref="Local"/>
		<StateModel ref="StateModel"/>

		<!-- TODO: Configure a publisher -->
		<!--<Publisher class="File">
			<Param name="FileName" value="fuzzed.png"/>
		</Publisher>-->
		<Publisher name="test" class="TcpClient">
			<Param name="Host" value="127.0.0.1"/>
			<Param name="Port" value="50008"/>
		</Publisher>

		<Publisher name="null" class="Null" />

		<!-- OPTIONAL: Configure a strategy -->
		<!--Strategy class="Random">
			<Param name="MaxFieldsToMutate" value="0"/>
		</Strategy-->
		<Strategy class="Random">
			<Param name="SwitchCount" value="2"/>
		</Strategy>
		
		<Logger class="File">
			<Param name="Path" value="logs"/>
		</Logger>
	</Test>

</Peach>
	<!-- end -->
