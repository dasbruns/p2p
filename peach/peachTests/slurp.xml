<?xml version="1.0" encoding="utf-8"?>
<Peach xmlns="http://peachfuzzer.com/2012/Peach" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://peachfuzzer.com/2012/Peach /peach/peach.xsd">

	<!-- TODO: Create data model -->
	<DataModel name="M1">
		<String name="d1"/>
	</DataModel>
	<DataModel name="M2">
		<String name="c1" value="def"/>
	</DataModel>
	<DataModel name="end">
		<String name="c1" value="bye"/>
	</DataModel>

	<StateModel name="StateModel" initialState="InitialState">
		<State name="InitialState">
			<Action name="rec" type="input">
				<DataModel name="read" ref="M1" />
			</Action>
			<Action type="changeState" ref="muh"/>
		</State>
		<State name="muh">
			<Action type="slurp" valueXpath="//StateModel//InitialState//rec//read//d1"  setXpath="//StateModel//muh//out//write//c1"/>	
				<!--valueXpath="StateModel//InitialState//out//write//d1"/-->
			<Action name="out" type="output">
				<DataModel name="write" ref="M2" />
			</Action>
			<Action type="changeState" ref="3" when="str(StateModel.states['InitialState'].actions[0].dataModel['d1'].InternalValue) == 'exit'"/>
			<Action type="changeState" ref="InitialState"/>
		</State>
		<State name="3">
			<Action type="output">
				<DataModel ref="end"/>
			</Action>
			<Action type="close"/>
		</State>
	</StateModel>

	<!-- TODO: Configure Agent -->
	<!--Agent name="TheAgent" location="http://127.0.0.1:9000">
	</Agent-->

	<Agent name="Local">
		<!--Monitor class="LinuxCrashMonitor"/-->
		<Monitor class="Process">
			<Param name="Executable" value="./server"/>
			<Param name="StartOnCall" value="Start"/>
			<Param name="Arguments" value="fuzzed.bin"/>
		</Monitor>
	</Agent>

	<Test name="Default">
		<Agent ref="Local"/>
		<StateModel ref="StateModel"/>

		<!-- TODO: Configure a publisher -->
		<!--<Publisher class="File">
			<Param name="FileName" value="fuzzed.png"/>
		</Publisher>-->
		<Publisher name="test" class="TcpClient">
			<Param name="Host" value="127.0.0.1"/>
			<Param name="Port" value="50007"/>
		</Publisher>

		<Publisher class="stdout.Stdout" />

		<!-- OPTIONAL: Configure a strategy -->
		<!--Strategy class="Random">
			<Param name="MaxFieldsToMutate" value="0"/>
		</Strategy-->
		
		<Logger class="File">
			<Param name="Path" value="logs"/>
		</Logger>
	</Test>

</Peach>
<!-- end -->
